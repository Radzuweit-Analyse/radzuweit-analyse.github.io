---
interface Props {
  email: string;
  className?: string;
}

const { email, className = '' } = Astro.props;
const id = `mailbtn-${Math.random().toString(36).slice(2)}`;
const idJS = JSON.stringify(id);
const emailJS = JSON.stringify(email);
---

<button id={id} class={className} type="button">
  <slot />
</button>

<script>
  (function(){
    const btn = document.getElementById({idJS});
    const email = {emailJS};
    btn.addEventListener('click', () => {
      const a = Math.floor(Math.random()*5)+1;
      const b = Math.floor(Math.random()*5)+1;
      const answer = prompt(`Please verify you're human: ${a} + ${b} = ?`);
      if(parseInt(answer,10) === a + b) {
        window.location.href = `mailto:${email}`;
      } else {
        alert('Incorrect answer, please try again.');
      }
    });
  })();
</script>
