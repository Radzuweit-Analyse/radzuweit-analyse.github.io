---
interface Props {
  contact: string;
  type: 'email' | 'phone';
  label?: string;
  className?: string;
}

const { contact, type, label = type === 'email' ? 'Show email' : 'Show phone', className = '' } = Astro.props;
const id = `reveal-${Math.random().toString(36).slice(2)}`;
const idJS = JSON.stringify(id);
const contactJS = JSON.stringify(contact);
const typeJS = JSON.stringify(type);
---

<button id={id} class={className}>{label}</button>

<script>
  (function(){
    const btn = document.getElementById({idJS});
    const contact = {contactJS};
    const type = {typeJS};
    const classes = btn.className;
    btn.addEventListener('click', () => {
      const a = Math.floor(Math.random()*5)+1;
      const b = Math.floor(Math.random()*5)+1;
      const answer = prompt(`Please verify you're human: ${a} + ${b} = ?`);
      if(parseInt(answer,10) === a + b) {
        if(type === 'email') {
          btn.outerHTML = `<a href="mailto:${contact}" class="${classes}">${contact}</a>`;
        } else {
          btn.outerHTML = `<a href="tel:${contact}" class="${classes}">${contact}</a>`;
        }
      } else {
        alert('Incorrect answer, please try again.');
      }
    });
  })();
</script>
